


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=windows-1252"> 
  <title>Coverage Report > State</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">com.heslingtonhustle.state</a>
</div>

<h1>Coverage Summary for Class: State (com.heslingtonhustle.state)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">State</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    42.1%
  </span>
  <span class="absValue">
    (16/38)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    41.9%
  </span>
  <span class="absValue">
    (62/148)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package com.heslingtonhustle.state;
&nbsp;
&nbsp;import com.badlogic.gdx.maps.MapProperties;
&nbsp;
&nbsp;import java.util.*;
&nbsp;
&nbsp;
&nbsp;/**
&nbsp; * Contains all data related to the logical state of the game.
&nbsp; * Acts as coordinator for the whole game, mutating the state given a player&#39;s Action.
&nbsp; * This class should be queried in order to perform tasks like rendering.
&nbsp; */
&nbsp;public class State {
&nbsp;    private static final int MAX_DAYS = 7;
&nbsp;    private boolean gameOver;
&nbsp;    private final Clock clock;
&nbsp;    private final DialogueManager dialogueManager;
<b class="fc">&nbsp;    private final HashMap&lt;String, Activity&gt; activities = new HashMap&lt;&gt;();</b>
&nbsp;    // A reference to the current closest trigger the player can interact with
&nbsp;    private MapProperties currentTrigger;
&nbsp;    private int energy;
&nbsp;    private int hoursSlept;
&nbsp;    private MapProperties newMapTrigger;
<b class="fc">&nbsp;    private Boolean fading = false;</b>
<b class="fc">&nbsp;    private Boolean sleeping = false;</b>
&nbsp;
&nbsp;
<b class="fc">&nbsp;    public State(DialogueManager dialogueManager) {</b>
<b class="fc">&nbsp;        gameOver = false;</b>
&nbsp;
<b class="fc">&nbsp;        clock = new Clock();</b>
<b class="fc">&nbsp;        this.dialogueManager = dialogueManager;</b>
&nbsp;
<b class="fc">&nbsp;        replenishEnergy();</b>
<b class="fc">&nbsp;        currentTrigger = null; // This stores the Tiled trigger box that we are currently stood inside of</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;
&nbsp;    /**
&nbsp;     * Adds the amount of time passed to the in game clock
&nbsp;     * @param delta The time to add in seconds
&nbsp;     */
&nbsp;    public void passTime(float delta) {
<b class="fc">&nbsp;        clock.increaseTime(delta);</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;
&nbsp;    /**
&nbsp;     * Tells the game which trigger the player is nearest in
&nbsp;     * case they want to interact with it.
&nbsp;     * @param trigger The closest trigger object
&nbsp;     */
&nbsp;    public void setNearestTrigger(MapProperties trigger) {
<b class="fc">&nbsp;        currentTrigger = trigger;</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Returns the trigger containing information about the new map to
&nbsp;     * switch to
&nbsp;     * @return The MapProperties of the trigger pointing to the new map,
&nbsp;     * returns null if no map needs to be switched to
&nbsp;     */
&nbsp;    public MapProperties getNewMapTrigger() {
<b class="nc">&nbsp;        return newMapTrigger;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Sets the new map trigger to null
&nbsp;     */
&nbsp;    public void resetNewMapTrigger() {
<b class="nc">&nbsp;        newMapTrigger = null;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Gets the nearest trigger object to the player
&nbsp;     * @return The MapProperties representing the closest trigger to the player
&nbsp;     */
&nbsp;    public MapProperties getNearestTrigger() {
<b class="nc">&nbsp;        return currentTrigger;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * @return True if the screen needs to be fading to black
&nbsp;     */
&nbsp;    public boolean getFading() {
<b class="nc">&nbsp;        return fading;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Set the value of fading
&nbsp;     * @param fading The boolean to set it to
&nbsp;     */
&nbsp;    public void setFading(Boolean fading) {
<b class="nc">&nbsp;        this.fading = fading;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * True if the game needs to sleep on the next black screen
&nbsp;     */
&nbsp;    public Boolean getSleeping() {
<b class="nc">&nbsp;        return sleeping;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Set if the game needs to sleep on the next black screen
&nbsp;     */
&nbsp;    public void setSleeping(Boolean sleeping) {
<b class="nc">&nbsp;        this.sleeping = sleeping;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Performs various actions based on the current trigger
&nbsp;     * nearest the player.
&nbsp;     */
&nbsp;    public void handleInteraction() {
<b class="fc">&nbsp;        if (currentTrigger == null) {</b>
<b class="nc">&nbsp;            return;</b>
&nbsp;        }
&nbsp;
&nbsp;        // Read sign
<b class="fc">&nbsp;        if (currentTrigger.containsKey(&quot;sign&quot;)) {</b>
<b class="fc">&nbsp;            dialogueManager.addDialogue((String) currentTrigger.get(&quot;sign&quot;));</b>
<b class="fc">&nbsp;            return;</b>
&nbsp;        }
&nbsp;
&nbsp;        // Talk to NPC
<b class="fc">&nbsp;        if (currentTrigger.containsKey(&quot;dialogue&quot;)) {</b>
&nbsp;            // Show dialogue
<b class="nc">&nbsp;            dialogueManager.addDialogue((String) currentTrigger.get(&quot;dialogue&quot;));</b>
<b class="nc">&nbsp;            return;</b>
&nbsp;        }
&nbsp;
&nbsp;        // Change map
<b class="fc">&nbsp;        if (currentTrigger.containsKey(&quot;new_map&quot;)) {</b>
<b class="nc">&nbsp;            List&lt;String&gt; options = new ArrayList&lt;&gt;(Arrays.asList(&quot;Yes&quot;, &quot;No&quot;));</b>
<b class="nc">&nbsp;            String prompt = currentTrigger.get(&quot;prompt&quot;, String.class);</b>
<b class="nc">&nbsp;            dialogueManager.addDialogue(prompt, options, selectedOption -&gt; {</b>
<b class="nc">&nbsp;                        if (selectedOption == 0) {</b>
<b class="nc">&nbsp;                            newMapTrigger = currentTrigger;</b>
<b class="nc">&nbsp;                            fading = true;</b>
&nbsp;                        }
<b class="nc">&nbsp;                    }</b>
&nbsp;            );
&nbsp;        }
&nbsp;
&nbsp;        // Sleep at a house
<b class="fc">&nbsp;        if (currentTrigger.containsKey(&quot;sleep&quot;)) {</b>
&nbsp;            // If player has not slept yet
<b class="fc">&nbsp;            if (!activities.containsKey(&quot;sleep&quot;)) {</b>
<b class="fc">&nbsp;                activities.put(&quot;sleep&quot;, new Activity(</b>
&nbsp;                        &quot;sleep&quot;, &quot;sleep&quot;,
&nbsp;                        5, 0, 8, -1)
&nbsp;                );
&nbsp;            }
&nbsp;
<b class="fc">&nbsp;            List&lt;String&gt; options = new ArrayList&lt;&gt;(Arrays.asList(&quot;Yes&quot;, &quot;No&quot;));</b>
<b class="fc">&nbsp;            dialogueManager.addDialogue(&quot;Do you want to sleep?&quot;, options, selectedOption -&gt; {</b>
<b class="nc">&nbsp;                    if (selectedOption == 0) {</b>
<b class="nc">&nbsp;                        fading = true;</b>
<b class="nc">&nbsp;                        sleeping = true;</b>
&nbsp;                    }
<b class="nc">&nbsp;                }</b>
&nbsp;            );
<b class="fc">&nbsp;            return;</b>
&nbsp;        }
&nbsp;
&nbsp;        // Call an activity that is not sleeping
<b class="nc">&nbsp;        if (currentTrigger.containsKey(&quot;activity&quot;)) {</b>
<b class="nc">&nbsp;            String activityName = (String) currentTrigger.get(&quot;activity&quot;);</b>
&nbsp;
&nbsp;            // On the first encounter with an activity, create a new Activity class
&nbsp;            // to store how many times this activity has been completed
<b class="nc">&nbsp;            if (!activities.containsKey(activityName)) {</b>
&nbsp;                // Creates an activity class from MapProperties and stores it
&nbsp;                // with the activity name
<b class="nc">&nbsp;                activities.put(activityName, Activity.toActivity(currentTrigger));</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            Activity activity = activities.get(activityName);</b>
&nbsp;
&nbsp;            // Call a dialogue box to prompt the player if they want to do
&nbsp;            // the listed activity
<b class="nc">&nbsp;            List&lt;String&gt; options = new ArrayList&lt;&gt;(Arrays.asList(&quot;Yes&quot;, &quot;No&quot;));</b>
<b class="nc">&nbsp;            dialogueManager.addDialogue((String) currentTrigger.get(&quot;prompt_message&quot;), options, selectedOption -&gt; {</b>
<b class="nc">&nbsp;                    if (selectedOption == 0) {</b>
&nbsp;                        // If &#39;yes&#39;, do activity
<b class="nc">&nbsp;                        doActivity(activity);</b>
&nbsp;                    }
<b class="nc">&nbsp;                }</b>
&nbsp;            );
&nbsp;        }
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Completes the actions needed when the player sleeps
&nbsp;     */
&nbsp;    public void sleep() {
<b class="fc">&nbsp;        hoursSlept += getHoursSlept();</b>
&nbsp;
<b class="fc">&nbsp;        if (!activities.containsKey(&quot;sleep&quot;)) {</b>
<b class="fc">&nbsp;            activities.put(&quot;sleep&quot;, new Activity(</b>
&nbsp;                    &quot;sleep&quot;, &quot;sleep&quot;,
&nbsp;                    5, 0, 8, -1)
&nbsp;            );
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        activities.get(&quot;sleep&quot;).completeActivity();</b>
<b class="fc">&nbsp;        dialogueManager.addDialogue(&quot;You have just slept!&quot;);</b>
<b class="fc">&nbsp;        advanceDay();</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;
&nbsp;    /**
&nbsp;     * Checks whether a player can do an activity, and if so updates
&nbsp;     * appropriate values
&nbsp;     * Also shows a success/fail dialogue box
&nbsp;     * @param activity The activity to complete
&nbsp;     */
&nbsp;    private void doActivity(Activity activity) {
&nbsp;
&nbsp;        // Activities that can be done any time
<b class="nc">&nbsp;        HashSet&lt;String&gt; doAnytime = new HashSet&lt;&gt;(3);</b>
<b class="nc">&nbsp;        doAnytime.add(&quot;cat&quot;);</b>
<b class="nc">&nbsp;        doAnytime.add(&quot;ducks&quot;);</b>
<b class="nc">&nbsp;        doAnytime.add(&quot;picnic&quot;);</b>
&nbsp;
&nbsp;
&nbsp;        // Various checks for if the player can do the activity
<b class="nc">&nbsp;        if (!activity.canDoActivity()) {</b>
<b class="nc">&nbsp;            dialogueManager.addDialogue(&quot;You&#39;ve done this too much today!\nGo do something else!&quot;);</b>
<b class="nc">&nbsp;        } else if (energy &lt; activity.getEnergyUse()) {</b>
<b class="nc">&nbsp;            dialogueManager.addDialogue(&quot;You don&#39;t have enough energy to do this right now!&quot;);</b>
<b class="nc">&nbsp;        } else if (!(clock.getRawTime() &gt; 480) &amp;&amp; !doAnytime.contains(activity.getName())) {</b>
<b class="nc">&nbsp;            dialogueManager.addDialogue(&quot;This building opens at 8am.&quot;);</b>
&nbsp;        } else {
&nbsp;            // They can do it
<b class="nc">&nbsp;            activity.completeActivity();</b>
<b class="nc">&nbsp;            exertEnergy(activity.getEnergyUse());</b>
<b class="nc">&nbsp;            clock.passHours(activity.getHours());</b>
&nbsp;            // Gets the success message from the most recent trigger
<b class="nc">&nbsp;            dialogueManager.addDialogue((String) currentTrigger.get(&quot;success_message&quot;));</b>
&nbsp;        }
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Advances the game in the day, also displays a message, and ends the game
&nbsp;     * if the max number of days has been reached
&nbsp;     */
&nbsp;    private void advanceDay() {
<b class="fc">&nbsp;        clock.incrementDay();</b>
<b class="fc">&nbsp;        addEnergy(getHoursSleptTonight());</b>
&nbsp;
<b class="fc">&nbsp;        if (clock.getDay() &gt; MAX_DAYS) {</b>
<b class="nc">&nbsp;            dialogueManager.addDialogue(&quot;Today is the day of your exam!&quot; +</b>
<b class="nc">&nbsp;                    &quot;\nI hope you studied well!&quot;, selectedOption -&gt; gameOver = true);</b>
<b class="nc">&nbsp;            return;</b>
&nbsp;        } else {
<b class="fc">&nbsp;            pushStartDayDialogue();</b>
&nbsp;        }
&nbsp;
&nbsp;        // The player is only allowed to do the same activity twice once
&nbsp;        // in a day
<b class="fc">&nbsp;        if (activities.containsKey(&quot;study&quot;)) {</b>
<b class="nc">&nbsp;            Activity study = activities.get(&quot;study&quot;);</b>
<b class="nc">&nbsp;            if (study.getTimesCompletedToday() == 2) {</b>
<b class="nc">&nbsp;                study.setMaxPerDay(1);</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        for (Activity activity : activities.values()) {</b>
<b class="fc">&nbsp;            activity.dayAdvanced();</b>
<b class="fc">&nbsp;        }</b>
&nbsp;
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    //Debug function
&nbsp;    public void printActivities() {
<b class="nc">&nbsp;        StringBuilder builder = new StringBuilder();</b>
&nbsp;
<b class="nc">&nbsp;        for (String s : activities.keySet()) {</b>
<b class="nc">&nbsp;            builder.append(s).append(&quot; count: &quot;).append(activities.get(s).getTimesCompleted()).append(&quot;\n&quot;);</b>
&nbsp;            //builder.append(s).append(&quot; value: &quot;).append(activities.get(s).getValue()).append(&quot;\n&quot;);
<b class="nc">&nbsp;        }</b>
&nbsp;
<b class="nc">&nbsp;        String result = builder.toString();</b>
<b class="nc">&nbsp;        dialogueManager.addDialogue(result);</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public String getTime() {
<b class="nc">&nbsp;        return clock.getTime();</b>
&nbsp;    }
&nbsp;    public int getDay() {
<b class="nc">&nbsp;        return clock.getDay();</b>
&nbsp;    }
&nbsp;    public String getDebugTime() {
<b class="nc">&nbsp;        return clock.getDebugString();</b>
&nbsp;    }
&nbsp;    public DialogueManager getDialogueManager() {
<b class="fc">&nbsp;        return dialogueManager;</b>
&nbsp;    }
&nbsp;    public boolean noDialogueOnScreen() {
<b class="nc">&nbsp;        return dialogueManager.queueEmpty();</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Gives the player an intro dialogue
&nbsp;     */
&nbsp;    public void pushStartDayDialogue() {
<b class="fc">&nbsp;        int day = clock.getDay();</b>
<b class="fc">&nbsp;        if (day == 7) {</b>
<b class="nc">&nbsp;            dialogueManager.addDialogue(</b>
&nbsp;                    &quot;You have 1 day left until your exam!\nMake sure you study, eat and have fun!&quot;);
<b class="fc">&nbsp;        } else if (day != MAX_DAYS+1) {</b>
<b class="fc">&nbsp;            dialogueManager.addDialogue(</b>
<b class="fc">&nbsp;                    String.format(&quot;You have %s days left until your exam!\nMake sure you study, eat and have fun!&quot;, MAX_DAYS-day+1));</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * DEBUG
&nbsp;     * Displays a debug panel
&nbsp;     */
&nbsp;    public void pushTestDialogue() {
&nbsp;        // This is a debugging function that creates a useful control dialog box when you press &#39;/&#39;
<b class="nc">&nbsp;        List&lt;String&gt; options = new ArrayList&lt;&gt;(Arrays.asList(&quot;End Game&quot;, &quot;Decrement day&quot;, &quot;Set time speed to VERY FAST&quot;, &quot;Set time speed to normal&quot;, &quot;Close&quot;));</b>
<b class="nc">&nbsp;        dialogueManager.addDialogue(&quot;This is the debugging console. Please select an option&quot;, options, selectedOption -&gt; {</b>
<b class="nc">&nbsp;            switch (selectedOption) {</b>
&nbsp;                case 0: // Option 0 selected
<b class="nc">&nbsp;                    setGameOver();</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case 1: // Option 1 selected
<b class="nc">&nbsp;                    clock.decrementDay();</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case 2:
<b class="nc">&nbsp;                    clock.setSpeed(15f);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case 3:
<b class="nc">&nbsp;                    clock.setSpeed(1.5f);</b>
&nbsp;                    break;
&nbsp;            }
<b class="nc">&nbsp;        });</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Sets the player&#39;s energy to 100
&nbsp;     */
&nbsp;    public void replenishEnergy() {
<b class="fc">&nbsp;        energy = 100;</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Adds a certain amount of energy to the player&#39;s energy bar
&nbsp;     * based on the amount of hours they slept
&nbsp;     * @param hours The number of hours the player slept
&nbsp;     */
&nbsp;    public void addEnergy(int hours) {
<b class="fc">&nbsp;        energy += hours*12;</b>
<b class="fc">&nbsp;        if (energy &gt;= 100) {</b>
<b class="fc">&nbsp;            energy = 100;</b>
&nbsp;        }
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Returns the number of hours slept in this night
&nbsp;     */
&nbsp;    private int getHoursSleptTonight() {
&nbsp;        // Before midnight
<b class="fc">&nbsp;        if (clock.getRawTime() &lt;= 1440) {</b>
<b class="fc">&nbsp;            return (int) Math.floor((1440 - clock.getRawTime()) + 8*60);</b>
&nbsp;        } else {
&nbsp;            // After midnight
<b class="nc">&nbsp;            return (int) Math.floor((8*60) - clock.getRawTime());</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    /**
&nbsp;     * @return The total hours slept in the game
&nbsp;     */
&nbsp;    public int getHoursSlept() {
<b class="fc">&nbsp;        return hoursSlept;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Decreases the player&#39;s energy by a set amount
&nbsp;     * @param energyCost The amount to decrease by
&nbsp;     */
&nbsp;    private void exertEnergy(int energyCost) {
<b class="nc">&nbsp;        energy -= energyCost;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * @return True if the last day has finished
&nbsp;     */
&nbsp;    public boolean isGameOver() {
<b class="nc">&nbsp;        return gameOver;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Sets the game to be over
&nbsp;     */
&nbsp;    public void setGameOver() {
<b class="nc">&nbsp;        gameOver = true;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * @return The player&#39;s energy level, max is 100
&nbsp;     */
&nbsp;    public int getEnergy() {
<b class="fc">&nbsp;        return energy;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * @return A hashmap of activities so their data can be used for scoring
&nbsp;     */
&nbsp;    public HashMap&lt;String, Activity&gt; getActivities() {
<b class="fc">&nbsp;        return activities;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * @return The instance of the clock (for testing)
&nbsp;     */
<b class="fc">&nbsp;    public Clock getClock() { return clock; }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * @return The current trigger (for testing)
&nbsp;     */
<b class="fc">&nbsp;    public MapProperties getCurrentTrigger() { return currentTrigger; }</b>
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-05-20 15:06</div>
</div>
</body>
</html>
